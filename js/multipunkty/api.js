window.$MP=window.$MP||{};$MP.base=$MP.base||{};$MP.callbacks=$MP.callbacks||{};$MP.cookie=$MP.cookie||{};$MP.utils=$MP.utils||{};Function.prototype.bind=function(context){var method=this;return function(){return method.apply(context,arguments);};};$MP.base.callback=function(identifier,args){var fn=$MP.callbacks[identifier];if(fn){delete $MP.callbacks[identifier];setTimeout(function(){fn.apply(this,args);},1);}};$MP.base.getContainer=function(id,isNewContainerBlocked){id=id||'mp-container';var c=document.getElementById(id);if(!c&&!isNewContainerBlocked){c=document.createElement('div');c.id=id;document.body.appendChild(c);}return c;};$MP.base.request=function(url,callback,options){options=$MP.utils.defaults(options,{delay:4,allowCache:false});if(callback){var identifier;do identifier='_'+$MP.utils.generateIdentifier(16);while($MP.callbacks[identifier]);$MP.callbacks[identifier]=callback;url=$MP.utils.appendQueryString(url,'cb='+encodeURIComponent(identifier));}if(!options.allowCache){url=$MP.utils.appendQueryString(url,'d='+new Date().getTime());}setTimeout(function(){var c=$MP.base.getContainer();c.innerHTML='';var s=document.createElement('script');s.setAttribute('type','text/javascript');s.src=document.location.protocol.match(/https/i)?url.replace(/http:/i,'https:'):url;c.appendChild(s);},options.delay);};$MP.cookie.get=function(name,cookieFormat){cookieFormat=cookieFormat||1;var ca=document.cookie.split(';');for(var i=0,c;c=ca[i++];){while(c.charAt(0)==' ')c=c.substring(1);if(c.indexOf(name+'=')==0){var content=c.substring(name.length+1),result={};switch(cookieFormat){case 0:try{while(content.length>0){var nameLength=parseInt(content.substr(0,2),16),name=content.substr(2,nameLength),valueLength=parseInt(content.substr(2+nameLength,2),16),value=content.substr(2+nameLength+2,valueLength);content=content.substr(2+nameLength+2+valueLength);result[name]=value;}}catch(e){return null;}return result;case 1:return $MP.utils.parseQueryString(content);}}}return null;};$MP.cookie.remove=function(name,options){options=$MP.utils.defaults(options,{domain:null});var date=new Date();date.setTime(date.getTime()+(-365*24*60*60*1000));document.cookie=name+'=; expires='+date.toGMTString()+'; path=/'+(options.domain?'; domain='+options.domain:'');};$MP.cookie.set=function(name,object,options){options=$MP.utils.defaults(options,{cookieFormat:1,domain:null});var output='';switch(options.cookieFormat){case 0:for(var name in object){var value=object[name].toString();if(value)output+=$MP.utils.toHex(name.length,2)+name+$MP.utils.toHex(value.length,2)+value;}break;case 1:output=$MP.utils.toQueryString(object);break;}var date=new Date();date.setTime(date.getTime()+(365*24*60*60*1000));document.cookie=name+'='+output+'; expires='+date.toGMTString()+'; path=/'+(options.domain?'; domain='+options.domain:'');};$MP.utils.appendQueryString=function(url,queryString){return url+(url.indexOf('?')==-1?'?':'&')+queryString;};$MP.utils.asBool=function(value){if(!value||(value.length==0))return false;var type=typeof(value);if((type=='number')||(type=='boolean'))return true;value=value.toLowerCase();if((value=='1')||(value=='true'))return true;return false;};$MP.utils.defaults=function(object,defaults){if(!object){object=defaults;}else{for(var name in defaults){if(object[name]==undefined){object[name]=defaults[name];}}}return object;};$MP.utils.format=function(str){var params=arguments;return str.replace(/\{(\d+)\}/g,function(match,group){var idx=parseInt(group);if((idx>=0)&&(idx<params.length-1))return params[idx+1].toString();else throw'Argument of index '+idx+' not found!';});};$MP.utils.generateIdentifier=function(length){length=length||16;var result='';for(var i=0;i<8;i++){var r=Math.floor(Math.random()*36);if(r<10){result+=String.fromCharCode('0'.charCodeAt(0)+r);}else{result+=String.fromCharCode('a'.charCodeAt(0)+r-10);}}return result;};$MP.utils.isEmpty=function(object){if(!object)return true;var cnt=0;for(var x in object)cnt++;return cnt==0;};$MP.utils.jsonSerialize=function(json){if(JSON.stringify!==undefined){return JSON.stringify(json);}else{}};$MP.utils.parseQueryString=function(qs){if(!qs&&window.location.search)qs=window.location.search.substring(1);var result={};if(qs){var qsAry=qs.split('&');for(var i=0,component;component=qsAry[i++];){if(component.length>0){var pair=component.split('='),key=pair[0],value=pair[1];if(key.length>0){if(value&&(value.length>0)){try{value=decodeURIComponent(value).toString();}catch(e){value=unescape(value).toString();}}else{value=new String();}result[key]=value;}}}}return result;};$MP.utils.toHex=function(value,digits){var max=1<<(digits*4);if((value<0)||(value>=max))throw'Invalid hex conversion';var result=value.toString(16);while(result.length<digits){result='0'+result;}return result;};$MP.utils.toQueryString=function(object){var result='',i=0;for(var name in object){result+=(i++?'&':'')+name+'='+(object[name]||'');}return result;};$MP.utils.toStringSeparated=function(value){var output='';var m=value.toString().match(/(-)?(\d+)([,.]\d+)?/);if(m&&m[2]){var sep='';var i=m[2].length;while(i>0){var x=i-3;if(x<0)x=0;output=m[2].substr(x,i-x)+(sep.length?sep:'')+output;sep=' ';i-=3;}if(m[1]){output=m[1]+output;}if(m[3]){output+=m[3];}}return output;};$MP.utils.trim=function(str){return $MP.utils.trimRight($MP.utils.trimLeft(str));};$MP.utils.trimLeft=function(str){return str.replace(/^\s+/,'');};$MP.utils.trimRight=function(str){return str.replace(/\s+$/,'');};$MP.api=$MP.api||{};$MP.api.connectAccount=function(appId,ufk,secret,args,options){if(!appId||!ufk||!secret)return;options=options||{};var to=encodeURIComponent(options.to||'polaczenie-kont');$MP.api.post('http://multipunkty.pl/referrer?to='+to,'ConnectAccounts',$MP.utils.defaults({appId:appId,ufk:ufk,secret:secret},args),options);};$MP.api.connectPartner=function(appId,partnerFK,secret,eventUrl,returnUrl,args,options){if(!appId||!partnerFK||!eventUrl||!returnUrl)return;options=options||{};var to=encodeURIComponent(options.to||'landing');$MP.api.post('http://partner.multipunkty.pl/referrer?to='+to,'ConnectPartner',$MP.utils.defaults({appId:appId,partnerFK:partnerFK,secret:secret,eventUrl:eventUrl,returnUrl:returnUrl},args),options);};$MP.api.getCurrentUser=function(callback,options){if(!callback)return;$MP.api.query('GET','api/1/users/context/current',null,options,function(response){if(response&&(response.statusCode==200)){callback(response.data);return;}callback(null);});};$MP.api.query=function(method,path,args,options,onResponse){args=args||{};options=$MP.utils.defaults(options,{showLoginWindow:true});var requestArgs={method:method,path:encodeURIComponent(path),args:encodeURIComponent($MP.utils.toQueryString(args)),r:encodeURIComponent(document.referrer)};$MP.base.request('http://multipunkty.pl/api-query?'+$MP.utils.toQueryString(requestArgs),function(response){if(response){if(response.statusCode==200){onResponse(response);return;}if(options.showLoginWindow&&(response.statusCode==401)){options.showLoginWindow=false;$MP.api.showLoginWindow({onWindowClosed:function(){$MP.api.query(method,path,args,options,onResponse);}});return;}}onResponse(response);});};$MP.api.post=function(url,action,args,options){if(!url||!action)return;args=args||{};options=options||{};var form=document.createElement('form');form.action=url;form.method='POST';form.target=!options.isTargetSelf?'_blank':'_self';function addParam(name,value){var input=document.createElement('input');input.type='hidden';input.id=name;input.name=name;input.value=value;form.appendChild(input);}addParam('action',action);addParam('args',$MP.utils.jsonSerialize(args));document.body.appendChild(form);form.submit();document.body.removeChild(form);};$MP.api.showLoginWindow=function(options){options=$MP.utils.defaults(options,{title:'Authorization',width:250,height:150,onWindowClosed:null});var url='http://multipunkty.pl/zaloguj-multipunkty';var wnd=window.open(url,options.title,$MP.utils.format('width={0},height={1}',options.width,options.height));if(wnd){var intervalID=setInterval(function(){if(wnd.closed){clearInterval(intervalID);if(options.onWindowClosed){options.onWindowClosed();}}},100);if(window.focus){wnd.focus();}}};(function(){var queue=document.$MP$queue;document.$MP$queue=[];if(queue){for(var i=0,item;item=queue[i++];){item();}}})();